<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generatore Integratori Personalizzato | A.S.D Centro Fitness</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --light-bg: #f8f9fa;
            --mass-color: #3498db;
            --definition-color: #e74c3c;
            --weightloss-color: #2ecc71;
            --endurance-color: #f39c12;
            --wellness-color: #9b59b6;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            background-color: var(--light-bg);
            color: #333;
            padding: 0;
            position: relative;
            min-height: 100vh;
            padding-bottom: 80px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        /* HEADER STYLISH */
        header {
            background: linear-gradient(135deg, var(--primary), #1a2533);
            color: white;
            padding: 3rem 1rem 2rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, var(--accent), var(--secondary));
        }
        
        header h1 {
            font-size: clamp(1.8rem, 4vw, 2.5rem);
            margin: 0 0 0.5rem;
            font-weight: 800;
            letter-spacing: 0.5px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        header p {
            font-size: clamp(1rem, 2vw, 1.2rem);
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto 0.5rem;
        }
        
        .partner-link {
            display: inline-block;
            margin-top: 0.5rem;
            color: white;
            font-size: 0.9rem;
            text-decoration: none;
            border-bottom: 1px dashed rgba(255,255,255,0.5);
            transition: all 0.3s;
        }
        
        .partner-link:hover {
            color: var(--secondary);
            border-bottom-color: var(--secondary);
        }

        /* PROMO BANNER */
        .promo-banner {
            background: linear-gradient(135deg, #f39c12, #e74c3c);
            color: white;
            padding: 0.8rem;
            text-align: center;
            font-weight: bold;
            margin: 0 -1.5rem 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .promo-code {
            background: white;
            color: #e74c3c;
            padding: 0.3rem 0.6rem;
            border-radius: 4px;
            font-family: monospace;
            margin-left: 0.5rem;
            font-weight: bolder;
        }
        
        /* FORM ELEGANT */
        .form-container {
            padding: 2rem 1.5rem;
            background: white;
            position: relative;
        }
        
        .form-container::before {
            content: "";
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            height: 1px;
            background: linear-gradient(90deg, transparent, #ddd, transparent);
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
            position: relative;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.75rem;
            font-weight: 600;
            color: var(--primary);
            font-size: 0.95rem;
            position: relative;
            padding-left: 1.5rem;
        }
        
        .form-group label::before {
            content: "";
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 12px;
            height: 12px;
            background: var(--secondary);
            border-radius: 2px;
        }
        
        input, select {
            width: 100%;
            padding: 0.85rem 1rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
            background: #f8fafc;
            -webkit-appearance: none;
        }
        
        input:focus, select:focus {
            border-color: var(--secondary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
            background: white;
        }
        
        /* Stile personalizzato per select su mobile */
        select {
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%232c3e50'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: 12px;
            padding-right: 2.5rem;
        }
        
        /* Miglioramenti per iOS */
        label, button, .goal-tab {
            cursor: pointer;
        }
        
        .checkbox-group {
            position: relative;
            padding-left: 35px;
            min-height: 30px;
            display: flex;
            align-items: center;
            margin: 1.5rem 0;
        }
        
        .checkbox-group input[type="checkbox"] {
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 24px !important;
            height: 24px !important;
            min-width: 24px !important;
            min-height: 24px !important;
            margin-right: 10px;
            accent-color: var(--accent);
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            border: 2px solid #ddd;
            border-radius: 4px;
            outline: none;
            transition: all 0.3s;
        }
        
        .checkbox-group input[type="checkbox"]:checked {
            background-color: var(--accent);
            border-color: var(--accent);
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white'%3E%3Cpath d='M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: center;
            background-size: 16px;
        }
        
        .checkbox-group label {
            padding-left: 0;
            margin-bottom: 0;
            font-weight: normal;
            cursor: pointer;
        }
        
        /* Miglioramento feedback al tocco per iOS */
        button:active, .goal-tab:active {
            transform: scale(0.98);
        }
        
        /* Aggiungi questa regola per migliorare il click su mobile */
        #generate-btn {
            -webkit-tap-highlight-color: transparent;
        }
        
        button {
            background: linear-gradient(135deg, var(--accent), #c0392b);
            color: white;
            border: none;
            padding: 1rem 1.5rem;
            font-size: 1.05rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            width: 100%;
            margin: 1rem 0 0;
            box-shadow: 0 4px 6px rgba(231, 76, 60, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(231, 76, 60, 0.3);
        }
        
        button::after {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                to bottom right,
                rgba(255, 255, 255, 0.3),
                rgba(255, 255, 255, 0)
            );
            transform: rotate(30deg);
        }
        
        button:hover::after {
            animation: shine 1.5s infinite;
        }
        
        @keyframes shine {
            100% {
                left: 150%;
            }
        }
        
        /* BADGE OBIETTIVO */
        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: bold;
            color: white;
        }
        
        /* NAVIGAZIONE A TAB */
        .goal-tabs {
            display: flex;
            overflow-x: auto;
            padding: 0.5rem 1.5rem;
            background: #f1f5f9;
            margin: 0 -1.5rem;
            scrollbar-width: none;
        }
        
        .goal-tabs::-webkit-scrollbar {
            display: none;
        }
        
        .goal-tab {
            flex: 0 0 auto;
            padding: 0.75rem 1.5rem;
            margin-right: 0.5rem;
            background: white;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            white-space: nowrap;
            display: flex;
            align-items: center;
        }
        
        .goal-tab i {
            margin-right: 0.5rem;
        }
        
        .goal-tab.active {
            background: var(--accent);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(231, 76, 60, 0.3);
        }
        
        .goal-tab[data-goal="mass"] { border-left: 4px solid var(--mass-color); }
        .goal-tab[data-goal="definition"] { border-left: 4px solid var(--definition-color); }
        .goal-tab[data-goal="weightloss"] { border-left: 4px solid var(--weightloss-color); }
        .goal-tab[data-goal="endurance"] { border-left: 4px solid var(--endurance-color); }
        .goal-tab[data-goal="wellness"] { border-left: 4px solid var(--wellness-color); }
        
        /* RISULTATI */
        #results {
            display: none;
            padding: 1.5rem;
            background-color: #f5f7fa;
        }
        
        .results-header {
            margin-bottom: 1.5rem;
            display: flex;
            flex-direction: column;
        }
        
        /* CARD INTEGRATORI */
        .supplements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
        }
        
        .supplement-card {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            border-top: 4px solid var(--accent);
            transition: transform 0.3s, box-shadow 0.3s;
            display: flex;
            flex-direction: column;
        }
        
        .supplement-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .supplement-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }
        
        .supplement-title {
            font-size: 1.25rem;
            color: var(--primary);
            margin: 0;
            font-weight: 700;
            line-height: 1.3;
        }
        
        .priority-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: bold;
            background: linear-gradient(to right, #f39c12, #e74c3c);
            color: white;
            margin-left: 0.5rem;
        }
        
        .supplement-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            margin: 0.75rem 0;
            font-size: 0.85rem;
        }
        
        .meta-item {
            display: flex;
            align-items: center;
            color: #555;
        }
        
        .meta-item i {
            margin-right: 0.3rem;
            color: var(--secondary);
            font-size: 0.9rem;
        }
        
        /* SEZIONE DOSAGGIO */
        .dosage-section {
            background: #f8fafc;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            position: relative;
        }
        
        .dosage-section::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--secondary);
            border-radius: 4px 0 0 4px;
        }
        
        .dosage-amount {
            font-weight: 700;
            color: var(--primary);
            font-size: 1.1rem;
        }
        
        /* COMPOSIZIONE */
        .composition-section {
            margin: 1rem 0;
        }
        
        .section-title {
            font-size: 0.9rem;
            text-transform: uppercase;
            color: #666;
            margin-bottom: 0.75rem;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
        }
        
        .section-title i {
            margin-right: 0.5rem;
            font-size: 1rem;
        }
        
        .composition-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 0.75rem;
        }
        
        .composition-item {
            background: #f1f8fe;
            padding: 0.75rem;
            border-radius: 6px;
            font-size: 0.85rem;
        }
        
        .composition-name {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 0.25rem;
        }
        
        .composition-value {
            color: #555;
            font-size: 0.8rem;
        }
        
        /* BENEFICI */
        .benefits-list {
            margin-left: 1.25rem;
        }
        
        .benefits-list li {
            position: relative;
            padding-left: 1.5rem;
            margin-bottom: 0.5rem;
            line-height: 1.5;
            font-size: 0.9rem;
        }
        
        .benefits-list li::before {
            content: "";
            position: absolute;
            left: 0;
            top: 0.5rem;
            width: 0.75rem;
            height: 0.75rem;
            background-color: var(--accent);
            border-radius: 50%;
        }
        
        /* ALLERGENI */
        .allergens-warning {
            margin-top: auto;
            padding-top: 1rem;
            font-size: 0.8rem;
            color: #e74c3c;
            display: flex;
            align-items: flex-start;
        }
        
        .allergens-warning i {
            margin-right: 0.5rem;
            font-size: 1rem;
        }
        
        /* TABELLA ALLERGENI */
        .allergens-table {
            width: 100%;
            margin: 2rem 0;
            border-collapse: collapse;
            background: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        
        .allergens-table th, .allergens-table td {
            padding: 12px;
            border: 1px solid #eee;
            text-align: left;
        }
        
        .allergens-table th {
            background: var(--primary);
            color: white;
        }
        
        /* FOOTER COMPLETO */
        .gym-footer {
            position: relative;
            background: var(--primary);
            color: white;
            padding: 2rem 1.5rem 0;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            padding-bottom: 1.5rem;
        }

        .footer-section {
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .footer-section h3 {
            font-size: 1.1rem;
            margin-bottom: 1rem;
            color: white;
            position: relative;
            display: inline-block;
        }

        .footer-section h3::after {
            content: "";
            position: absolute;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 2px;
            background: var(--accent);
        }

        .footer-links {
            margin-top: 1rem;
        }

        .footer-links a {
            color: white;
            text-decoration: none;
            margin: 0 5px;
            transition: color 0.3s;
        }

        .footer-links a:hover {
            color: var(--secondary);
            text-decoration: underline;
        }

        .copyright-notice {
            border-top: 1px solid rgba(255,255,255,0.1);
            padding: 1rem 0;
            text-align: center;
            font-size: 0.8rem;
            opacity: 0.8;
        }
        
        /* MEDIA QUERIES */
        @media (max-width: 768px) {
            .supplements-grid {
                grid-template-columns: 1fr;
            }
            
            .composition-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
            
            header {
                padding: 2rem 1rem 1.5rem;
            }
            
            .footer-content {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }
            
            .footer-section {
                text-align: center;
            }
            
            .footer-links {
                display: flex;
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .footer-links a {
                margin: 0;
            }
        }
        
        @media (max-width: 480px) {
            .goal-tab {
                padding: 0.6rem 1rem;
                font-size: 0.85rem;
            }
            
            .supplement-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .priority-badge {
                margin: 0.5rem 0 0 0;
                align-self: flex-start;
            }
            
            .composition-grid {
                grid-template-columns: 1fr;
            }
            
            .form-container {
                padding: 1.5rem 1rem;
            }
            
            header h1 {
                font-size: 1.5rem;
            }
            
            /* Correzione per input number su mobile */
            input[type="number"] {
                font-size: 16px; /* Previene lo zoom automatico su iOS */
            }
            
            /* Miglioramenti per select su mobile */
            select {
                font-size: 16px; /* Previene lo zoom automatico */
                padding: 0.85rem 1rem;
                background-position: right 0.75rem center;
            }
            
            button {
                padding: 1rem;
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-dumbbell"></i> Generatore Integratori</h1>
            <p>Piano nutrizionale personalizzato per massimizzare i tuoi risultati</p>
            <a href="https://vitastrong.it/it/" class="partner-link" target="_blank">
                Integratori forniti da Vitastrong.it <i class="fas fa-external-link-alt"></i>
            </a>
        </header>
        
        <div class="form-container">
            <!-- Banner promozionale aggiunto -->
            <div class="promo-banner">
                <i class="fas fa-tags"></i> CODICE SCONTO ATTIVO: 
                <span class="promo-code">Missile01</span> - 20% di sconto su tutti gli integratori!
            </div>
            
            <div class="form-grid">
                <div class="form-group">
                    <label for="weight">Peso (kg)</label>
                    <input type="number" id="weight" min="40" max="200" placeholder="Es. 75" required>
                </div>
                
                <div class="form-group">
                    <label for="height">Altezza (cm)</label>
                    <input type="number" id="height" min="140" max="220" placeholder="Es. 180" required>
                </div>
            </div>
            
            <div class="form-group">
                <label for="goal">Obiettivo</label>
                <select id="goal" required>
                    <option value="">-- Seleziona un obiettivo --</option>
                    <option value="mass">Incremento Massa Muscolare</option>
                    <option value="definition">Definizione Muscolare</option>
                    <option value="weightloss">Dimagrimento</option>
                    <option value="endurance">Resistenza</option>
                    <option value="wellness">Benessere del Corpo</option>
                </select>
            </div>
            
            <div class="checkbox-group">
                <input type="checkbox" id="gluten-free">
                <label for="gluten-free" style="cursor: pointer;">Sono celiaco (mostra solo integratori senza glutine)</label>
            </div>
            
            <button id="generate-btn" onclick="generatePlan()">
                <i class="fas fa-bolt"></i> Genera la Mia Scheda Integratori
            </button>
        </div>
        
        <div id="results">
            <div class="goal-tabs">
                <button class="goal-tab active" data-goal="mass">
                    <i class="fas fa-dumbbell"></i> Massa
                </button>
                <button class="goal-tab" data-goal="definition">
                    <i class="fas fa-fire"></i> Definizione
                </button>
                <button class="goal-tab" data-goal="weightloss">
                    <i class="fas fa-weight"></i> Dimagrimento
                </button>
                <button class="goal-tab" data-goal="endurance">
                    <i class="fas fa-running"></i> Resistenza
                </button>
                <button class="goal-tab" data-goal="wellness">
                    <i class="fas fa-heartbeat"></i> Benessere
                </button>
            </div>
            
            <div class="results-header">
                <h2>La Tua Scheda Personalizzata</h2>
                <div style="display: flex; align-items: center; margin-top: 0.5rem;">
                    <span id="goal-badge" class="badge"></span>
                    <span style="margin-left: auto; font-size: 0.9rem;" id="user-bmi"></span>
                </div>
            </div>
            
            <div id="user-info" style="margin-bottom: 1.5rem;"></div>
            
            <div class="supplements-grid" id="plan-output">
                <!-- Popolato dinamicamente via JavaScript -->
            </div>
            
            <h3 style="margin: 2rem 0 1rem;"><i class="fas fa-exclamation-triangle"></i> Tabella Allergeni</h3>
            <table class="allergens-table" id="allergens-output">
                <!-- Popolato dinamicamente via JavaScript -->
            </table>
            
            <button onclick="saveAsPDF()"><i class="fas fa-file-pdf"></i> Scarica Piano Completo</button>
        </div>
    </div>
    
    <div class="gym-footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>A.S.D Centro Fitness</h3>
                <p>Via Roma, 287/A, 53014 Monteroni d'Arbia (SI)</p>
                <p>P.IVA: 01417350525</p>
                <p>C.F.: 92057520527</p>
                <p>Tel: <a href="tel:3895175911" style="color:white;text-decoration:none;">389 517 5911</a></p>
                <p>Email: <a href="mailto:AsdCentroFitness@gmail.com" style="color:white;text-decoration:none;">AsdCentroFitness@gmail.com</a></p>
            </div>
            
            <div class="footer-section">
                <h3>Informazioni Legali</h3>
                <p>© 2023 A.S.D Centro Fitness - Tutti i diritti riservati</p>
                <p>Associazione Sportiva Dilettantistica</p>
                <p>Registrata CONI</p>
            </div>
            
            <div class="footer-section">
                <h3>Privacy & Termini</h3>
                <p>Conforme al Regolamento UE 2016/679 (GDPR)</p>
                <p>e al D.Lgs. 196/2003 (Codice Privacy)</p>
                <div class="footer-links">
                    <a href="/privacy-policy">Privacy Policy</a> | 
                    <a href="/cookie-policy">Cookie Policy</a> | 
                    <a href="/termini-servizio">Termini di Servizio</a>
                </div>
            </div>
        </div>
        
        <div class="copyright-notice">
            <p>Il sito e i suoi contenuti sono protetti da copyright © 2023 A.S.D Centro Fitness. 
               È vietata la riproduzione, anche parziale, senza autorizzazione scritta.</p>
        </div>
    </div>

    <script>
        // Database di integratori con specifiche dettagliate
        const supplementsDB = {
            mass: [
                { 
                    name: "VitaStrong Whey Protein 100%", 
                    dosage: (weight) => `${Math.round(weight * 1.8)}g/giorno (${Math.round(weight * 1.8 / 30)} misurini da 30g)`, 
                    timing: "Post-workout (entro 30 minuti) e al mattino a digiuno",
                    tips: "Ideale per il recupero muscolare. Mescolare con 250-300ml di acqua o latte magro.",
                    composition: "Proteine isolate del siero del latte (90% proteine), BCAA (6g per 100g), glutammina (5g per 100g), enzimi digestivi",
                    benefits: [
                        "Aumenta la sintesi proteica muscolare",
                        "Riduce il catabolismo muscolare post-allenamento",
                        "Favorisce il recupero grazie al profilo aminoacidico completo",
                        "Facile digestione grazie agli enzimi aggiunti"
                    ],
                    glutenFree: true,
                    allergens: ["Latte"],
                    priority: "high"
                },
                { 
                    name: "VitaStrong Creatina Monoidrato", 
                    dosage: () => "5g/giorno (fase di carico: 20g/giorno per 5-7 giorni)", 
                    timing: "Preferibilmente post-workout con carboidrati semplici",
                    tips: "Per ottimizzare l'assorbimento, assumere con succo di frutta o bevanda zuccherata.",
                    composition: "Creatina monoidrato micronizzata (99.9% purezza)",
                    benefits: [
                        "Aumenta la forza esplosiva del 10-15%",
                        "Migliora la capacità di lavoro ad alta intensità",
                        "Aumenta la ritenzione intracellulare di acqua (volumizzazione muscolare)",
                        "Accelera il recupero tra le serie"
                    ],
                    glutenFree: true,
                    allergens: [],
                    priority: "high"
                },
                { 
                    name: "VitaStrong Mass Gainer Professional", 
                    dosage: (weight, height) => height > 175 ? "2 misurini/giorno" : "1 misurino/giorno", 
                    timing: "Lontano dagli allenamenti, preferibilmente a cena",
                    tips: "Contiene carboidrati complessi e proteine per un aumento di massa pulita.",
                    composition: "Proteine del siero del latte, maltodestrine, vitamine del gruppo B, enzimi digestivi",
                    benefits: [
                        "Apporto calorico controllato (450kcal per dose)",
                        "Rapporto ottimale 2:1 carboidrati/proteine",
                        "Arricchito con vitamine per il metabolismo energetico",
                        "Facile preparazione e digeribilità"
                    ],
                    glutenFree: false,
                    allergens: ["Latte", "Glutine", "Soia"],
                    priority: "medium"
                },
                { 
                    name: "VitaStrong BCAA 8:1:1", 
                    dosage: (weight) => `${Math.round(weight * 0.15)}g intra-workout`, 
                    timing: "Durante l'allenamento, sciolti in 500ml di acqua",
                    tips: "Rapporto ottimale di leucina per stimolare la sintesi proteica.",
                    composition: "L-Leucina, L-Isoleucina, L-Valina in rapporto 8:1:1",
                    benefits: [
                        "Riduce la fatica centrale durante l'allenamento",
                        "Previene il catabolismo muscolare",
                        "Stimola la sintesi proteica post-workout",
                        "Migliora la resistenza anaerobica"
                    ],
                    glutenFree: true,
                    allergens: [],
                    priority: "medium"
                }
            ],
            definition: [
                { 
                    name: "VitaStrong ISO Pure 100%", 
                    dosage: (weight) => `${Math.round(weight * 2.2)}g/giorno (suddivisi in 2-3 assunzioni)`, 
                    timing: "Colazione (a digiuno) e post-workout (entro 30 minuti)",
                    tips: "Particolarmente indicato in fase di definizione per il basso contenuto calorico.",
                    composition: "Proteine isolate del siero (95% proteine), peptidi bioattivi, L-leucina (3g per 100g)",
                    benefits: [
                        "Minimo apporto di carboidrati e grassi (<0.5g per dose)",
                        "Stimola la sintesi proteica senza apportare calorie in eccesso",
                        "Mantiene la massa magra durante il deficit calorico",
                        "Facile digestione anche per chi è intollerante al lattosio"
                    ],
                    glutenFree: true,
                    allergens: ["Latte"],
                    priority: "high"
                },
                { 
                    name: "VitaStrong Fat Burner Extreme", 
                    dosage: () => "2 capsule al mattino", 
                    timing: "30 min prima della colazione con un bicchiere d'acqua",
                    tips: "Termogenico con caffeina e tè verde per accelerare il metabolismo.",
                    composition: "Caffeina anidra (200mg), Estratto di tè verde (50% EGCG), L-tirosina, Capsaicina",
                    benefits: [
                        "Aumenta il metabolismo basale del 10-15%",
                        "Mobilizza gli acidi grassi dal tessuto adiposo",
                        "Riduce l'appetito e i picchi glicemici",
                        "Migliora la concentrazione e l'energia"
                    ],
                    glutenFree: true,
                    allergens: [],
                    priority: "high"
                },
                { 
                    name: "VitaStrong L-Carnitina 3000", 
                    dosage: (weight) => `${weight > 80 ? "3000mg" : "2000mg"}/giorno`, 
                    timing: "Pre-workout e mattina a digiuno",
                    tips: "Favorisce il trasporto degli acidi grassi nei mitocondri per l'energia.",
                    composition: "L-Carnitina L-Tartrato (3000mg per dose), Vitamina B6",
                    benefits: [
                        "Aumenta l'ossidazione dei grassi durante l'esercizio",
                        "Migliora il recupero post-allenamento",
                        "Aumenta la produzione energetica mitocondriale",
                        "Supporta la funzione cardiovascolare"
                    ],
                    glutenFree: true,
                    allergens: [],
                    priority: "medium"
                },
                { 
                    name: "VitaStrong CLA 1000", 
                    dosage: () => "2 capsule 2 volte al giorno", 
                    timing: "Con i pasti principali (pranzo e cena)",
                    tips: "Riduce la percentuale di grasso corporeo preservando la massa magra.",
                    composition: "Acido Linoleico Coniugato (1000mg per capsula), Olio di cartamo",
                    benefits: [
                        "Riduce l'accumulo di grasso viscerale",
                        "Migliora il rapporto massa magra/grassa",
                        "Azione anti-catabolica sul tessuto muscolare",
                        "Supporta i livelli di energia durante la dieta"
                    ],
                    glutenFree: true,
                    allergens: [],
                    priority: "medium"
                }
            ],
            weightloss: [
                { 
                    name: "VitaStrong Garcinia Cambogia", 
                    dosage: () => "2 capsule prima dei pasti", 
                    timing: "15 min prima di pranzo e cena con un bicchiere d'acqua",
                    tips: "Contiene acido idrossicitrico che aiuta a controllare l'appetito.",
                    composition: "Estratto di Garcinia Cambogia (60% HCA), Cromo picolinato, Cannella",
                    benefits: [
                        "Riduce la conversione di carboidrati in grassi",
                        "Aumenta il senso di sazietà",
                        "Stabilizza i livelli di zucchero nel sangue",
                        "Supporta il controllo del peso a lungo termine"
                    ],
                    glutenFree: true,
                    allergens: [],
                    priority: "high"
                },
                { 
                    name: "VitaStrong Green Tea Extract", 
                    dosage: () => "1 capsula 2 volte al giorno", 
                    timing: "Mattina e primo pomeriggio con acqua",
                    tips: "Estratto concentrato di tè verde con EGCG per il metabolismo dei grassi.",
                    composition: "Estratto di tè verde (50% EGCG), Caffeina naturale, L-Teanina",
                    benefits: [
                        "Aumenta la termogenesi del 3-8%",
                        "Potente azione antiossidante",
                        "Migliora la sensibilità all'insulina",
                        "Effetto diuretico naturale"
                    ],
                    glutenFree: true,
                    allergens: [],
                    priority: "high"
                },
                { 
                    name: "VitaStrong Glucomannano", 
                    dosage: () => "3 capsule con un bicchiere d'acqua prima dei pasti", 
                    timing: "30 min prima dei pasti principali",
                    tips: "Fibra solubile che aumenta il senso di sazietà.",
                    composition: "Fibra di glucomannano (1000mg per capsula), Inulina, Psyllium",
                    benefits: [
                        "Assorbe acqua formando un gel nello stomaco",
                        "Riduce l'assorbimento di grassi e carboidrati",
                        "Migliora la regolarità intestinale",
                        "Supporta la flora batterica intestinale"
                    ],
                    glutenFree: true,
                    allergens: [],
                    priority: "medium"
                },
                { 
                    name: "VitaStrong Chromium Picolinate", 
                    dosage: () => "1 capsula al giorno", 
                    timing: "Con la colazione",
                    tips: "Migliora il controllo della glicemia e riduce il desiderio di zuccheri.",
                    composition: "Cromo picolinato (200μg), Cannella, Acido alfa-lipoico",
                    benefits: [
                        "Riduce i picchi glicemici post-prandiali",
                        "Diminuisce la voglia di dolci",
                        "Migliora l'efficienza dell'insulina",
                        "Supporta il metabolismo dei macronutrienti"
                    ],
                    glutenFree: true,
                    allergens: [],
                    priority: "medium"
                }
            ],
            endurance: [
                { 
                    name: "VitaStrong Electrolyte Complex", 
                    dosage: (weight) => `${Math.round(weight * 0.5)}mg/ora di attività`, 
                    timing: "Durante l'esercizio prolungato, sciolto in 500ml di acqua",
                    tips: "Miscela bilanciata di sodio, potassio e magnesio per l'idratazione.",
                    composition: "Sodio (300mg), Potassio (150mg), Magnesio (75mg), Zinco, Vitamina B6",
                    benefits: [
                        "Previene i crampi muscolari",
                        "Mantiene l'equilibrio idro-salino",
                        "Supporta la contrazione muscolare",
                        "Migliora la performance in condizioni calde"
                    ],
                    glutenFree: true,
                    allergens: [],
                    priority: "high"
                },
                { 
                    name: "VitaStrong Beta-Alanina", 
                    dosage: () => "3-6g/giorno suddivisi in 2 dosi", 
                    timing: "Pre-workout e post-workout",
                    tips: "Aumenta la carnosina muscolare ritardando l'affaticamento.",
                    composition: "Beta-Alanina pura (1000mg per dose), Istidina",
                    benefits: [
                        "Aumenta la resistenza alla fatica del 15-20%",
                        "Migliora la performance in esercizi ad alta intensità",
                        "Protegge dall'acidità muscolare",
                        "Effetti cumulativi dopo 4 settimane"
                    ],
                    glutenFree: true,
                    allergens: [],
                    priority: "high"
                },
                { 
                    name: "VitaStrong Energy Gel", 
                    dosage: (weight) => `${weight > 70 ? "1 gel ogni 45 minuti" : "1 gel ogni 60 minuti"}`, 
                    timing: "Durante attività >60 minuti",
                    tips: "Fonte rapida di carboidrati con caffeina per prestazioni prolungate.",
                    composition: "Maltodestrine, Fruttosio, Caffeina (50mg), Sodio, Vitamine B",
                    benefits: [
                        "Fornisce energia immediata e prolungata",
                        "Facile da digerire durante l'esercizio",
                        "Mantiene stabili i livelli glicemici",
                        "Riduce la percezione della fatica"
                    ],
                    glutenFree: false,
                    allergens: ["Glutine"],
                    priority: "medium"
                },
                { 
                    name: "VitaStrong BCAA + Glutamina", 
                    dosage: (weight) => `${Math.round(weight * 0.2)}g durante l'allenamento`, 
                    timing: "Intra-workout, sciolti in 500ml di acqua",
                    tips: "Previene il catabolismo muscolare durante sforzi prolungati.",
                    composition: "BCAA 2:1:1, L-Glutamina, Elettroliti, Vitamina B6",
                    benefits: [
                        "Riduce il danno muscolare da endurance",
                        "Preserva la massa magra durante attività prolungate",
                        "Supporta la funzione immunitaria post-esercizio",
                        "Migliora il recupero tra sessioni"
                    ],
                    glutenFree: true,
                    allergens: [],
                    priority: "medium"
                }
            ],
            wellness: [
                { 
                    name: "VitaStrong Multivitaminico Complete", 
                    dosage: () => "1 compressa al giorno", 
                    timing: "Con il pasto principale",
                    tips: "Complesso completo di vitamine e minerali essenziali.",
                    composition: "12 Vitamine, 10 Minerali, Estratti vegetali, Antiossidanti",
                    benefits: [
                        "Copro il 100% del fabbisogno giornaliero",
                        "Supporta il sistema immunitario",
                        "Migliora energia e vitalità",
                        "Formulazione ad alto assorbimento"
                    ],
                    glutenFree: true,
                    allergens: [],
                    priority: "high"
                },
                { 
                    name: "VitaStrong Omega-3 Ultra", 
                    dosage: (weight) => `${weight > 80 ? "2 capsule 2 volte al giorno" : "2 capsule al giorno"}`, 
                    timing: "Con i pasti",
                    tips: "Alta concentrazione di EPA e DHA per cuore e articolazioni.",
                    composition: "Olio di pesce purificato (1000mg), EPA (400mg), DHA (300mg), Vitamina E",
                    benefits: [
                        "Supporta la salute cardiovascolare",
                        "Riduce l'infiammazione sistemica",
                        "Migliora la funzione cognitiva",
                        "Protegge le articolazioni"
                    ],
                    glutenFree: true,
                    allergens: ["Pesce"],
                    priority: "high"
                },
                { 
                    name: "VitaStrong Vitamina D3 5000 UI", 
                    dosage: () => "1 capsula al giorno", 
                    timing: "Con un pasto contenente grassi",
                    tips: "Supporta sistema immunitario e salute ossea.",
                    composition: "Vitamina D3 (5000 UI), Olio di oliva, Vitamina K2",
                    benefits: [
                        "Mantiene livelli ottimali di vitamina D",
                        "Supporta la salute delle ossa",
                        "Rinforza il sistema immunitario",
                        "Migliora l'umore e l'energia"
                    ],
                    glutenFree: true,
                    allergens: [],
                    priority: "medium"
                },
                { 
                    name: "VitaStrong Magnesio Bisglicinato", 
                    dosage: (weight) => `${Math.round(weight * 5)}mg prima di dormire`, 
                    timing: "La sera con acqua",
                    tips: "Forma altamente biodisponibile per rilassamento muscolare e sonno.",
                    composition: "Magnesio bisglicinato (500mg), Vitamina B6, Taurina",
                    benefits: [
                        "Riduce crampi e tensioni muscolari",
                        "Migliora la qualità del sonno",
                        "Supporta la funzione nervosa",
                        "Aiuta a gestire lo stress"
                    ],
                    glutenFree: true,
                    allergens: [],
                    priority: "medium"
                },
                { 
                    name: "VitaStrong Probiotic 10 Miliardi", 
                    dosage: () => "1 capsula al giorno", 
                    timing: "A stomaco vuoto al mattino",
                    tips: "Supporta la flora intestinale e la digestione.",
                    composition: "10 ceppi probiotici (10 miliardi UFC), Inulina, Fibra di acacia",
                    benefits: [
                        "Riequilibra il microbiota intestinale",
                        "Migliora digestione e assorbimento",
                        "Supporta la funzione immunitaria",
                        "Riduce gonfiore e discomfort addominale"
                    ],
                    glutenFree: true,
                    allergens: ["Latte"],
                    priority: "medium"
                }
            ]
        };
        
        // Nomi completi obiettivi
        const goalNames = {
            mass: "Massa Muscolare",
            definition: "Definizione Muscolare",
            weightloss: "Dimagrimento",
            endurance: "Resistenza",
            wellness: "Benessere Generale"
        };

        // Colori per i badge obiettivo
        const goalColors = {
            mass: "var(--mass-color)",
            definition: "var(--definition-color)",
            weightloss: "var(--weightloss-color)",
            endurance: "var(--endurance-color)",
            wellness: "var(--wellness-color)"
        };
        
        // GESTIONE NAVIGAZIONE A TAB
        document.querySelectorAll('.goal-tab').forEach(tab => {
            tab.addEventListener('click', function() {
                // Rimuovi active da tutte le tab
                document.querySelectorAll('.goal-tab').forEach(t => {
                    t.classList.remove('active');
                });
                
                // Aggiungi active alla tab cliccata
                this.classList.add('active');
                
                // Imposta il valore nel select
                document.getElementById('goal').value = this.dataset.goal;
                
                // Rigenera il piano se i risultati sono già visibili
                if(document.getElementById('results').style.display === 'block') {
                    generatePlan();
                }
            });
        });
        
        function generatePlan() {
            // Verifica se il form è valido
            if (!validateForm()) {
                return;
            }
            
            const weight = parseFloat(document.getElementById('weight').value);
            const height = parseFloat(document.getElementById('height').value);
            const goal = document.getElementById('goal').value;
            const glutenFree = document.getElementById('gluten-free').checked;
            
            // Aggiorna badge obiettivo
            const goalBadge = document.getElementById('goal-badge');
            goalBadge.textContent = goalNames[goal];
            goalBadge.style.background = goalColors[goal];
            
            // Calcola BMI
            const bmi = (weight / ((height/100) * (height/100))).toFixed(1);
            const bmiCategory = getBMICategory(weight, height);
            document.getElementById('user-bmi').textContent = `BMI: ${bmi} (${bmiCategory})`;
            
            // Mostra info utente
            document.getElementById('user-info').innerHTML = `
                <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <span><strong>Peso:</strong> ${weight} kg</span>
                        <span><strong>Altezza:</strong> ${height} cm</span>
                    </div>
                    ${glutenFree ? '<div style="color: #27ae60;"><i class="fas fa-check-circle"></i> <strong>Opzione senza glutine attiva</strong></div>' : ''}
                    <div style="margin-top: 0.5rem; color: #e74c3c; font-weight: bold;">
                        <i class="fas fa-tag"></i> Codice sconto attivo: <span style="font-family: monospace;">Missile01</span> (20% di sconto)
                    </div>
                </div>
            `;
            
            // Genera le card integratori
            let supplementsContent = '';
            let allergensContent = `
                <thead>
                    <tr>
                        <th>Integratore</th>
                        <th>Allergeni</th>
                    </tr>
                </thead>
                <tbody>
            `;
            
            let hasResults = false;
            
            supplementsDB[goal].forEach(supp => {
                // Filtra per glutine se richiesto
                if (glutenFree && !supp.glutenFree) return;
                
                hasResults = true;
                
                // Calcola dosaggi dinamici in base a peso/altezza
                const dosage = typeof supp.dosage === 'function' ? supp.dosage(weight, height) : supp.dosage;
                
                // Determina la priorità
                const priorityBadge = supp.priority === 'high' ? 
                    '<span class="priority-badge"><i class="fas fa-star"></i> Priorità Alta</span>' : 
                    '<span class="priority-badge" style="background: #3498db;"><i class="far fa-star"></i> Priorità Media</span>';
                
                // Crea la card
                supplementsContent += `
                    <div class="supplement-card">
                        <div class="supplement-header">
                            <h3 class="supplement-title">${supp.name}</h3>
                            ${priorityBadge}
                        </div>
                        
                        <div class="supplement-meta">
                            <div class="meta-item">
                                <i class="far fa-clock"></i> ${supp.timing}
                            </div>
                            ${supp.glutenFree ? '<div class="meta-item"><i class="fas fa-check-circle"></i> Senza glutine</div>' : ''}
                        </div>
                        
                        <div class="dosage-section">
                            <div class="section-title">
                                <i class="fas fa-syringe"></i> Dosaggio
                            </div>
                            <div class="dosage-amount">${dosage}</div>
                            <div class="dosage-timing">
                                <i class="fas fa-info-circle"></i> ${supp.tips}
                            </div>
                        </div>
                        
                        <div class="composition-section">
                            <div class="section-title">
                                <i class="fas fa-flask"></i> Composizione
                            </div>
                            <div class="composition-grid">
                                ${supp.composition.split(',').map(item => `
                                    <div class="composition-item">
                                        <div class="composition-name">${item.trim().split('(')[0]}</div>
                                        ${item.includes('(') ? 
                                            `<div class="composition-value">${item.match(/\(([^)]+)\)/)[1]}</div>` : 
                                            ''}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div>
                            <div class="section-title">
                                <i class="fas fa-bolt"></i> Benefici principali
                            </div>
                            <ul class="benefits-list">
                                ${supp.benefits.map(benefit => `
                                    <li>${benefit}</li>
                                `).join('')}
                            </ul>
                        </div>
                        
                        ${supp.allergens.length > 0 ? `
                            <div class="allergens-warning">
                                <i class="fas fa-exclamation-triangle"></i>
                                <div>Contiene: ${supp.allergens.join(', ')}</div>
                            </div>
                        ` : ''}
                    </div>
                `;
                
                // Aggiungi alla tabella allergeni
                allergensContent += `
                    <tr>
                        <td>${supp.name}</td>
                        <td>${supp.allergens.length > 0 ? supp.allergens.join(", ") : "Nessun allergene conosciuto"}</td>
                    </tr>
                `;
            });
            
            if (!hasResults) {
                supplementsContent = `
                    <div class="supplement-card" style="grid-column: 1 / -1; text-align: center; padding: 2rem;">
                        <i class="fas fa-info-circle" style="font-size: 2rem; color: var(--secondary); margin-bottom: 1rem;"></i>
                        <h3>Nessun integratore disponibile con i filtri selezionati</h3>
                        <p>Prova a disattivare l'opzione "Sono celiaco" per vedere più risultati</p>
                    </div>
                `;
                
                allergensContent = `
                    <tr>
                        <td colspan="2" style="text-align: center; padding: 30px;">
                            Nessun integratore da visualizzare
                        </td>
                    </tr>
                `;
            }
            
            allergensContent += `</tbody>`;
            
            document.getElementById("plan-output").innerHTML = supplementsContent;
            document.getElementById("allergens-output").innerHTML = allergensContent;
            document.getElementById("results").style.display = 'block';
            
            // Scroll ai risultati
            document.getElementById("results").scrollIntoView({ behavior: 'smooth' });
        }
        
        function validateForm() {
            const weight = parseFloat(document.getElementById('weight').value);
            const height = parseFloat(document.getElementById('height').value);
            const goal = document.getElementById('goal').value;
            
            // Validazione
            if (!weight || weight < 40 || weight > 200) {
                alert("Inserisci un peso valido (40-200kg)");
                document.getElementById('weight').focus();
                return false;
            }
            
            if (!height || height < 140 || height > 220) {
                alert("Inserisci un'altezza valida (140-220cm)");
                document.getElementById('height').focus();
                return false;
            }
            
            if (!goal) {
                alert("Seleziona un obiettivo");
                document.getElementById('goal').focus();
                return false;
            }
            
            return true;
        }
        
        function getBMICategory(weight, height) {
            const bmi = weight / ((height/100) * (height/100));
            if (bmi < 18.5) return "Sottopeso";
            if (bmi < 25) return "Normopeso";
            if (bmi < 30) return "Sovrappeso";
            return "Obesità";
        }
        
        function saveAsPDF() {
            alert("Funzionalità PDF in sviluppo! (Utilizzeremo jsPDF per generare il PDF)");
            // Implementazione reale richiede jsPDF + html2canvas
        }
        
        // Aggiungi gestione eventi per il tasto Invio
        document.addEventListener('DOMContentLoaded', function() {
            // Gestione dell'invio con Enter
            document.querySelectorAll('input').forEach(input => {
                input.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        generatePlan();
                    }
                });
            });
            
            // Miglioramento per mobile: previene lo zoom automatico sugli input
            document.querySelectorAll('input, select').forEach(el => {
                el.addEventListener('focus', function() {
                    window.scrollTo(0, 0);
                    document.body.style.zoom = "100%";
                });
            });
        });
    </script>
</body>
</html>
